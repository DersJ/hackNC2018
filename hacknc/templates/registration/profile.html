{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block content %}
{% for tournament in user.tournaments.all %}


<div class="modal fade" id="{{tournament.slug}}modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">{{tournament.name}}</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<h6>Match Status per Team</h6>
				<div class="list-group">
				{% for team in tournament.teams.all %}

				{% if team.hostteammatch %}
				<a href="{{team.hostteammatch.get_absolute_url}}" class="list-group-item list-group-item-action">{{team.name}} - matched with host(s): 
				{% for host in team.hostteammatch.hosts.all%}
				{{host.name}}, 
				{% endfor %}</a>

				{% else %}
				<p class="list-group-item list-group-item-action">{{team.name}} - no match yet</p>
				{% endif %}
				{% endfor %}
			</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<form action="{% url 'housing:matcher' tournament.slug_key tournament.slug %}" method="POST">
					{% csrf_token %}
				<button type="submit" class="btn btn-primary">Run Matcher</button>
			</form>
			</div>
		</div>
	</div>
</div>

{% endfor %}

<div class="container">
	<div class="row">
		<div class="col-sm-4">

			<div class="card">
				<div class="card-body">
					{% if user.name %}
					<h4 class="card-title">{{user.name}}</h4>
					<h5 class="card-subtitle mb-2 text-muted">@{{user.username}}</h4>

					{% else %}
					<h4 class="card-title">@{{user.username}}</h4>
					{% endif %}
					
					<p class="card-text">{{user.email}}</p>
				</div>
			</div>

		</div>
		<div class="col-sm-8">
			<h3>Match Info</h3>

			<h4>Tournaments</h4>
			<ul class="list-group">
				{% for tournament in user.tournaments.all %}
				<li class="list-group-item">
						
					<div class="row d-flex align-items-center">
					<div class="col-sm-8">
					<h5>{{tournament.name}}</h5>
					
					{% if tournament.is_locked %}
					Locked on {{tournament.date_lockout}}.
					{% else %}	
					Unlocked until {{tournament.date_lockout}}.
					{% endif %}
					</div>
					<div class="col-sm-4 text-right">
						{% if tournament.is_locked %}
					<button type="button" class="btn btn-sm btn-warning" data-toggle="modal" data-target="#{{tournament.slug}}modal">View more</button>
					{% else %}
					<button type="button" class="btn btn-sm btn-outline-secondary" data-toggle="modal" data-target="#{{tournament.slug}}modal">View More</button>
					{% endif %}
					</div>
				</div>
				</li>
				{% endfor %}

			</ul>

			<br>
			<h4>Teams</h4>
			<div class="list-group">
				{% for team in user.teams.all %}

				{% if team.hostteammatch %}
				<a href="{{team.hostteammatch.get_absolute_url}}" class="list-group-item list-group-item-action">{{team.name}} - matched with host(s): 
				{% for host in team.hostteammatch.hosts.all%}
				{{host.name}}, 
				{% endfor %}</a>

				{% else %}
				<a href="#" class="list-group-item list-group-item-action">{{team.name}} - no match yet</a>
				{% endif %}
				{% endfor %}
			</div>
			<br>
			<h4>Hosts</h4>
			<div class="list-group">
				{% for host in user.hosts.all %}
				{% if host.match %}
				<a href="{{host.match.get_absolute_url}}" class="list-group-item list-group-item-action">{{host.name}} - matched with team {{host.match.team.name}}</a>
				{% else %}
				<a href="#" class="list-group-item list-group-item-action">{{host.name}} - no match yet</a>
				{% endif %}
				{% endfor %}
			</div>

		</div>
	</div>
</div>


{% endblock %}
